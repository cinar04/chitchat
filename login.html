<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ChitChat Login</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="login-body">

  <div class="login-box">
    <h1>ChitChat</h1>
    <input type="text" id="loginKey" placeholder="Giriş Anahtarı">
    <button id="loginBtn">Giriş Yap</button>
  </div>

<script type="module">
import { db } from "./firebase.js";
import {
  collection,
  query,
  where,
  getDocs
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const btn = document.getElementById("loginBtn");

btn.addEventListener("click", async () => {
  const key = document.getElementById("loginKey").value.trim();

  if (!key) {
    alert("Anahtar gir");
    return;
  }

  const q = query(
    collection(db, "users"),
    where("loginKey", "==", key)
  );

  const snap = await getDocs(q);

  if (snap.empty) {
    alert("Yanlış anahtar");
    return;
  }

  const doc = snap.docs[0];
  const userData = doc.data();

  // SADECE GEREKLİLERİ KAYDET
  localStorage.setItem("userNo", userData.userNo);
  localStorage.setItem("nickname", userData.nickname);

  window.location.href = "index.html";
});
</script>

</body>
</html>
